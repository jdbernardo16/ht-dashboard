import{m,j as V,y as $,x as A,d as T,o as N,w as r,e as i,a as d,g as p,t as u,n as P,s as n}from"./app-DIXSCgPE.js";import{_ as j}from"./AuthenticatedLayout-_5prmJNd.js";import{D as O,_ as B}from"./Pagination-BH6EuZQ9.js";import{_ as I}from"./SearchFilter-DSYnmZHA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-D2ye1GDc.js";const M={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},U={class:"font-medium text-green-600"},J={__name:"Index",props:{sales:{type:Object,required:!0},clients:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})}},setup(f){const a=f,o=m(!1),s=m({search:a.filters.search||"",status:a.filters.status||"",date_from:a.filters.date_from||"",date_to:a.filters.date_to||"",min_amount:a.filters.min_amount||"",max_amount:a.filters.max_amount||""}),g=V(()=>a.sales.data||[]),v=[{key:"id",label:"ID",sortable:!0},{key:"product_name",label:"Product",sortable:!0},{key:"client",label:"Client",sortable:!0},{key:"amount",label:"Amount",type:"currency",sortable:!0},{key:"sale_date",label:"Date",type:"date",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"payment_method",label:"Payment",sortable:!0}],_=[{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],y=[{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],b=()=>{n.visit("/sales/create")},x=e=>{n.visit(`/sales/${e.id}/edit`)},h=e=>{n.visit(`/sales/${e.id}`)},w=async e=>{if(confirm("Are you sure you want to delete this sale?"))try{o.value=!0,await n.delete(`/sales/${e.id}`,{preserveScroll:!0,onSuccess:()=>{},onError:t=>{console.error("Error deleting sale:",t),t.message?.includes("403")&&alert("You don't have permission to delete this sale.")},onFinish:()=>{o.value=!1}})}catch(t){o.value=!1,console.error("Error deleting sale:",t)}},c=()=>{o.value=!0;const e={};Object.keys(s.value).forEach(t=>{s.value[t]&&(e[t]=s.value[t])}),n.get("/sales",e,{preserveState:!0,preserveScroll:!0,only:["sales","filters"],onError:t=>{console.error("Error applying filters:",t),t.message?.includes("403")&&alert("You don't have permission to view sales.")},onFinish:()=>{o.value=!1}})},S=()=>{s.value={search:"",status:"",date_from:"",date_to:"",min_amount:"",max_amount:""},c()},C=e=>{n.visit(e,{preserveState:!0,preserveScroll:!0,only:["sales","clients","filters"]})},k=e=>parseFloat(e).toFixed(2),D=e=>new Date(e).toLocaleDateString(),E=e=>e?e.charAt(0).toUpperCase()+e.slice(1).replace("_"," "):"",F=e=>({pending:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800";return $(s,()=>{clearTimeout(window.filterTimeout),window.filterTimeout=setTimeout(()=>{c()},300)},{deep:!0}),A(()=>{}),(e,t)=>(N(),T(j,null,{header:r(()=>t[1]||(t[1]=[i("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Sales Management ",-1)])),default:r(()=>[i("div",null,[i("div",M,[d(I,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value=l),filters:["search","status","date","amount"],"status-options":_,onApply:c,onClear:S},null,8,["modelValue"]),d(O,{data:g.value,columns:v,filters:y,loading:o.value,onCreate:b,onView:h,onEdit:x,onDelete:w},{amount:r(({item:l})=>[i("span",U," $"+u(k(l.amount)),1)]),status:r(({item:l})=>[i("span",{class:P([F(l.status),"px-2 py-1 text-xs font-medium rounded-full"])},u(E(l.status)),3)]),sale_date:r(({item:l})=>[p(u(D(l.sale_date)),1)]),client:r(({item:l})=>[p(u(l.client?.name||"N/A"),1)]),_:1},8,["data","loading"]),d(B,{links:a.sales.links,from:a.sales.from,to:a.sales.to,total:a.sales.total,onNavigate:C},null,8,["links","from","to","total"])])])]),_:1}))}};export{J as default};
