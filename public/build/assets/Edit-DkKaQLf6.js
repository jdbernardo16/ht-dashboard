import{m as v,j as M,y as z,c as u,o as i,e,i as f,n as V,F as P,z as I,t as p,s as k,b as j,d as O,w as D,f as L,a as K,u as o,k as b,p as h,q as E}from"./app-DIXSCgPE.js";import{_ as R}from"./AuthenticatedLayout-_5prmJNd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"relative"},Q={class:"relative"},G=["value","placeholder","disabled"],J={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3"},W={key:0,class:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border border-gray-200 max-h-60 overflow-auto"},X={class:"py-1"},Y=["onMousedown"],Z={class:"font-medium"},ee={class:"text-sm text-gray-500"},te={key:1,class:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border border-gray-200"},se={class:"font-medium"},oe={__name:"Autocomplete",props:{modelValue:{type:[String,Number],default:""},placeholder:{type:String,default:"Search customers..."},disabled:{type:Boolean,default:!1},inputClass:{type:String,default:""},allowCreate:{type:Boolean,default:!0}},emits:["update:modelValue","select","create"],setup(y,{expose:m,emit:C}){const s=y,g=C,_=v(null),c=v(""),n=v([]),r=v(!1),t=v(!1),l=v(-1),w=v(null),A=M(()=>w.value?w.value.name:c.value),S=M(()=>s.allowCreate&&c.value.length>2&&!n.value.some(a=>a.name.toLowerCase().includes(c.value.toLowerCase()))),N=async a=>{if(a.length<2){n.value=[];return}t.value=!0;try{const d=await k.get("/api/clients/search",{search:a});n.value=d.data}catch(d){console.error("Error fetching suggestions:",d),n.value=[],d.response?.status===401&&(r.value=!1)}finally{t.value=!1}},F=a=>{c.value=a.target.value,w.value=null,g("update:modelValue",""),l.value=-1,clearTimeout(window.suggestionTimeout),window.suggestionTimeout=setTimeout(()=>{N(c.value)},300)},T=()=>{setTimeout(()=>{r.value=!1},200)},q=a=>{if(r.value)switch(a.key){case"ArrowDown":a.preventDefault(),l.value=Math.min(l.value+1,n.value.length+(S.value?1:0)-1);break;case"ArrowUp":a.preventDefault(),l.value=Math.max(l.value-1,-1);break;case"Enter":a.preventDefault(),l.value>=0&&(l.value<n.value.length?$(n.value[l.value]):S.value&&U());break;case"Escape":r.value=!1,l.value=-1;break}},$=a=>{w.value=a,c.value="",g("update:modelValue",a.id),g("select",a),r.value=!1,n.value=[]},U=async()=>{if(s.allowCreate)try{const d=(await k.post("/api/clients",{first_name:c.value.split(" ")[0],last_name:c.value.split(" ").slice(1).join(" ")||"Customer",email:null})).data;w.value=d,c.value="",g("update:modelValue",d.id),g("select",d),g("create",d),r.value=!1,n.value=[]}catch(a){console.error("Error creating customer:",a),a.response?.status===422?a.response.data.errors.email?alert("Please provide a valid email address for the new customer."):alert("Please check the customer information and try again."):a.response?.status===401?r.value=!1:alert("Failed to create new customer. Please try again.")}};return z(()=>s.modelValue,a=>{a||(w.value=null,c.value="")}),m({focus:()=>{_.value?.focus()}}),(a,d)=>(i(),u("div",H,[e("div",Q,[e("input",{type:"text",value:A.value,onInput:F,onFocus:d[0]||(d[0]=x=>r.value=!0),onBlur:T,onKeydown:q,placeholder:y.placeholder,disabled:y.disabled,class:V(["block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",y.inputClass]),ref_key:"inputRef",ref:_},null,42,G),t.value?(i(),u("div",J,d[1]||(d[1]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):f("",!0)]),r.value&&n.value.length>0?(i(),u("div",W,[e("ul",X,[(i(!0),u(P,null,I(n.value,(x,B)=>(i(),u("li",{key:x.id,onMousedown:ye=>$(x),class:V(["px-4 py-2 cursor-pointer hover:bg-gray-100 transition-colors",{"bg-gray-100":B===l.value,"text-blue-600":B===l.value}])},[e("div",Z,p(x.name),1),e("div",ee,p(x.email),1)],42,Y))),128))])])):f("",!0),r.value&&S.value?(i(),u("div",te,[e("div",{onMousedown:U,class:V(["px-4 py-2 cursor-pointer hover:bg-gray-100 transition-colors border-t border-gray-100",{"bg-gray-100":l.value===n.value.length,"text-blue-600":l.value===n.value.length}])},[e("div",se,' + Add new customer: "'+p(c.value)+'" ',1)],34)])):f("",!0)]))}},le={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ae={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},re={class:"p-6 text-gray-900"},ne={key:0,class:"mt-1 text-sm text-red-600"},de={key:0,class:"mt-1 text-sm text-red-600"},ie={key:0,class:"mt-1 text-sm text-red-600"},ue={key:0,class:"mt-1 text-sm text-red-600"},me={key:0,class:"mt-1 text-sm text-red-600"},ce={key:0,class:"mt-1 text-sm text-red-600"},pe={key:0,class:"mt-1 text-sm text-red-600"},fe={key:0,class:"mt-1 text-sm text-red-600"},ge={class:"flex items-center justify-end space-x-3"},ve=["disabled"],_e={__name:"Edit",props:{sale:{type:Object,required:!0}},setup(y){const m=y,C=r=>r?new Date(r).toISOString().split("T")[0]:"",s=j({client_id:m.sale.client_id||"",product_name:m.sale.product_name||"",description:m.sale.description||"",amount:m.sale.amount||0,sale_date:C(m.sale.sale_date),status:m.sale.status||"pending",payment_method:m.sale.payment_method||"cash",notes:m.sale.notes||""}),g=()=>{s.put(`/sales/${m.sale.id}`,{preserveScroll:!0,onSuccess:()=>{k.visit(`/sales/${m.sale.id}`)},onError:r=>{console.error("Error updating sale:",r)}})},_=r=>{console.log("Client selected:",r)},c=r=>{console.log("Client created:",r)},n=()=>{k.visit(`/sales/${m.sale.id}`)};return(r,t)=>(i(),O(R,null,{header:D(()=>t[8]||(t[8]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Edit Sale ",-1)])),default:D(()=>[e("div",null,[e("div",le,[e("div",ae,[e("div",re,[e("form",{onSubmit:L(g,["prevent"]),class:"space-y-6"},[e("div",null,[t[9]||(t[9]=e("label",{for:"client_id",class:"block text-sm font-medium text-gray-700"},"Client *",-1)),K(oe,{id:"client_id",modelValue:o(s).client_id,"onUpdate:modelValue":t[0]||(t[0]=l=>o(s).client_id=l),placeholder:"Search for a client by name or email...",class:"mt-1",onSelect:_,onCreate:c},null,8,["modelValue"]),o(s).errors.client_id?(i(),u("p",ne,p(o(s).errors.client_id),1)):f("",!0)]),e("div",null,[t[10]||(t[10]=e("label",{for:"product_name",class:"block text-sm font-medium text-gray-700"},"Product Name *",-1)),b(e("input",{type:"text",id:"product_name","onUpdate:modelValue":t[1]||(t[1]=l=>o(s).product_name=l),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,o(s).product_name]]),o(s).errors.product_name?(i(),u("p",de,p(o(s).errors.product_name),1)):f("",!0)]),e("div",null,[t[11]||(t[11]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700"},"Description",-1)),b(e("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=l=>o(s).description=l),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,o(s).description]]),o(s).errors.description?(i(),u("p",ie,p(o(s).errors.description),1)):f("",!0)]),e("div",null,[t[12]||(t[12]=e("label",{for:"amount",class:"block text-sm font-medium text-gray-700"},"Amount *",-1)),b(e("input",{type:"number",id:"amount","onUpdate:modelValue":t[3]||(t[3]=l=>o(s).amount=l),required:"",min:"0",step:"0.01",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,o(s).amount]]),o(s).errors.amount?(i(),u("p",ue,p(o(s).errors.amount),1)):f("",!0)]),e("div",null,[t[13]||(t[13]=e("label",{for:"sale_date",class:"block text-sm font-medium text-gray-700"},"Sale Date *",-1)),b(e("input",{type:"date",id:"sale_date","onUpdate:modelValue":t[4]||(t[4]=l=>o(s).sale_date=l),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,o(s).sale_date]]),o(s).errors.sale_date?(i(),u("p",me,p(o(s).errors.sale_date),1)):f("",!0)]),e("div",null,[t[15]||(t[15]=e("label",{for:"status",class:"block text-sm font-medium text-gray-700"},"Status *",-1)),b(e("select",{id:"status","onUpdate:modelValue":t[5]||(t[5]=l=>o(s).status=l),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},t[14]||(t[14]=[e("option",{value:"pending"},"Pending",-1),e("option",{value:"completed"},"Completed",-1),e("option",{value:"cancelled"},"Cancelled",-1)]),512),[[E,o(s).status]]),o(s).errors.status?(i(),u("p",ce,p(o(s).errors.status),1)):f("",!0)]),e("div",null,[t[17]||(t[17]=e("label",{for:"payment_method",class:"block text-sm font-medium text-gray-700"},"Payment Method *",-1)),b(e("select",{id:"payment_method","onUpdate:modelValue":t[6]||(t[6]=l=>o(s).payment_method=l),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},t[16]||(t[16]=[e("option",{value:"cash"},"Cash",-1),e("option",{value:"card"},"Card",-1),e("option",{value:"online"},"Online",-1)]),512),[[E,o(s).payment_method]]),o(s).errors.payment_method?(i(),u("p",pe,p(o(s).errors.payment_method),1)):f("",!0)]),e("div",null,[t[18]||(t[18]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Notes",-1)),b(e("textarea",{id:"notes","onUpdate:modelValue":t[7]||(t[7]=l=>o(s).notes=l),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,o(s).notes]]),o(s).errors.notes?(i(),u("p",fe,p(o(s).errors.notes),1)):f("",!0)]),e("div",ge,[e("button",{type:"button",onClick:n,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," Cancel "),e("button",{type:"submit",disabled:o(s).processing,class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"},p(o(s).processing?"Updating...":"Update Sale"),9,ve)])],32)])])])])]),_:1}))}};export{_e as default};
