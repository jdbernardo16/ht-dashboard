import{E as P,m as p,b as I,x as B,d as U,o as L,w as u,e as d,a as m,u as l,g as S,t as f,n as j,q as c}from"./app-DMsrlBw0.js";import{_ as z}from"./AuthenticatedLayout-CoyhxnNm.js";import{_ as R,a as Y}from"./Pagination-CBc77TNp.js";import{_ as G}from"./FormModal-C8My_P34.js";import{_ as H}from"./SearchFilter-CfrCYFaO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-Dm6rggBr.js";const J={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},K={class:"font-medium text-red-600"},se={__name:"Index",setup(Q){const{expenses:o,filters:s}=P().props,b=p(!1),g=p(!1),y=p(!1),r=p(null),i=I({id:null,description:"",amount:0,expense_date:new Date().toISOString().split("T")[0],category:"",status:"pending",payment_method:"cash",merchant:"",receipt_number:"",tax_amount:0,notes:""}),n=p({search:s.search||"",status:s.status||"",category:s.category||"",date_from:s.date_from||"",date_to:s.date_to||"",min_amount:s.min_amount||"",max_amount:s.max_amount||""}),w=[{key:"id",label:"ID",sortable:!0},{key:"category",label:"Category",sortable:!0},{key:"amount",label:"Amount",type:"currency",sortable:!0},{key:"expense_date",label:"Date",type:"date",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"merchant",label:"Merchant",sortable:!0}],_=[{value:"pending",label:"Pending"},{value:"paid",label:"Paid"},{value:"cancelled",label:"Cancelled"}],h=[{value:"Labor",label:"Labor"},{value:"Software",label:"Software"},{value:"Table",label:"Table"},{value:"Advertising",label:"Advertising"},{value:"Office Supplies",label:"Office Supplies"},{value:"Travel",label:"Travel"},{value:"Utilities",label:"Utilities"},{value:"Marketing",label:"Marketing"},{value:"Inventory",label:"Inventory"}],E=[{name:"category",label:"Category",type:"select",required:!0,options:h},{name:"title",label:"Title",type:"text",required:!0},{name:"description",label:"Description",type:"textarea",required:!0},{name:"amount",label:"Amount",type:"number",required:!0,min:0,step:.01},{name:"expense_date",label:"Expense Date",type:"date",required:!0},{name:"merchant",label:"Merchant",type:"text",required:!1},{name:"status",label:"Status",type:"select",required:!0,options:_},{name:"payment_method",label:"Payment Method",type:"select",required:!0,options:[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"online",label:"Online"},{value:"bank_transfer",label:"Bank Transfer"}]},{name:"receipt_number",label:"Receipt Number",type:"text",required:!1},{name:"tax_amount",label:"Tax Amount",type:"number",required:!1,min:0,step:.01},{name:"notes",label:"Notes",type:"textarea",required:!1}],C=[{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}],k=()=>{c.visit("/expenses/create")},T=e=>{c.visit(`/expenses/${e.id}/edit`)},q=e=>{c.visit(`/expenses/${e.id}`)},D=e=>{confirm("Are you sure you want to delete this expense?")&&c.delete(`/expenses/${e.id}`,{preserveScroll:!0,onSuccess:()=>{}})},F=e=>{y.value?i.put(`/expenses/${i.id}`,{preserveScroll:!0,onSuccess:()=>{v()},onError:t=>{r.value&&r.value.setErrors(t)}}):i.post("/expenses",{preserveScroll:!0,onSuccess:()=>{v()},onError:t=>{r.value&&r.value.setErrors(t)}})},v=()=>{g.value=!1,i.reset(),r.value&&r.value.resetForm()},x=()=>{b.value=!0;const e={};Object.keys(n.value).forEach(t=>{n.value[t]&&(e[t]=n.value[t])}),c.get("/expenses",e,{preserveState:!0,preserveScroll:!0,only:["expenses","filters"],onError:t=>{console.error("Error applying filters:",t),t.message?.includes("403")&&alert("You don't have permission to view expenses.")},onFinish:()=>{b.value=!1}})},M=()=>{n.value={search:"",status:"",category:"",date_from:"",date_to:"",min_amount:"",max_amount:""},x()},$=e=>{c.visit(e,{preserveState:!0,preserveScroll:!0,only:["expenses","filters"]})};B(n,()=>{clearTimeout(window.filterTimeout),window.filterTimeout=setTimeout(()=>{x()},300)},{deep:!0});const A=e=>parseFloat(e).toFixed(2),N=e=>new Date(e).toLocaleDateString(),O=e=>e.charAt(0).toUpperCase()+e.slice(1).replace("_"," "),V=e=>({pending:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800";return(e,t)=>(L(),U(z,null,{header:u(()=>t[1]||(t[1]=[d("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Expense Management ",-1)])),default:u(()=>[d("div",null,[d("div",J,[m(H,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),filters:["search","status","category","date","amount"],"status-options":_,"category-options":h,onApply:x,onClear:M},null,8,["modelValue"]),m(R,{data:l(o).data,columns:w,filters:C,pagination:l(o),loading:b.value,onCreate:k,onView:q,onEdit:T,onDelete:D},{amount:u(({item:a})=>[d("span",K," $"+f(A(a.amount)),1)]),status:u(({item:a})=>[d("span",{class:j([V(a.status),"px-2 py-1 text-xs font-medium rounded-full"])},f(O(a.status)),3)]),expense_date:u(({item:a})=>[S(f(N(a.expense_date)),1)]),category:u(({item:a})=>[S(f(a.category),1)]),_:1},8,["data","pagination","loading"]),m(Y,{links:l(o).links,from:l(o).from,to:l(o).to,total:l(o).total,onNavigate:$},null,8,["links","from","to","total"])])]),m(G,{show:g.value,title:y.value?"Edit Expense":"Create New Expense",fields:E,"initial-data":l(i),loading:l(i).processing,onClose:v,onSubmit:F,ref_key:"formModal",ref:r},null,8,["show","title","initial-data","loading"])]),_:1}))}};export{se as default};
