import{E as j,m as f,b as L,y as U,d as z,o as i,w as u,e as s,a as g,u as l,c as p,i as R,F as H,z as W,t as b,g as E,n as Y,s as m}from"./app-DIXSCgPE.js";import{_ as G}from"./AuthenticatedLayout-_5prmJNd.js";import{D as J,_ as K}from"./Pagination-BH6EuZQ9.js";import{_ as Q}from"./FormModal-iR8cdvxI.js";import{_ as X}from"./SearchFilter-DSYnmZHA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-D2ye1GDc.js";const Z={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ee={class:"font-medium text-red-600"},te={class:"flex items-center space-x-1"},ae=["src","alt"],se={key:1,class:"h-8 w-8 bg-blue-100 rounded border flex items-center justify-center"},le={key:0,class:"text-xs text-gray-500"},re={key:1,class:"text-xs text-gray-400"},fe={__name:"Index",setup(ne){const{expenses:c,filters:r}=j().props,v=f(!1),h=f(!1),w=f(!1),n=f(null),d=L({id:null,description:"",amount:0,expense_date:new Date().toISOString().split("T")[0],category:"",status:"pending",payment_method:"cash",merchant:"",receipt_number:"",tax_amount:0,notes:""}),o=f({search:r.search||"",status:r.status||"",category:r.category||"",date_from:r.date_from||"",date_to:r.date_to||"",min_amount:r.min_amount||"",max_amount:r.max_amount||""}),C=[{key:"id",label:"ID",sortable:!0},{key:"category",label:"Category",sortable:!0},{key:"amount",label:"Amount",type:"currency",sortable:!0},{key:"expense_date",label:"Date",type:"date",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"merchant",label:"Merchant",sortable:!0},{key:"receipts",label:"Receipts",sortable:!1}],k=[{value:"pending",label:"Pending"},{value:"paid",label:"Paid"},{value:"cancelled",label:"Cancelled"}],S=[{value:"Labor",label:"Labor"},{value:"Software",label:"Software"},{value:"Table",label:"Table"},{value:"Advertising",label:"Advertising"},{value:"Office Supplies",label:"Office Supplies"},{value:"Travel",label:"Travel"},{value:"Utilities",label:"Utilities"},{value:"Marketing",label:"Marketing"},{value:"Inventory",label:"Inventory"}],T=[{name:"category",label:"Category",type:"select",required:!0,options:S},{name:"title",label:"Title",type:"text",required:!0},{name:"description",label:"Description",type:"textarea",required:!0},{name:"amount",label:"Amount",type:"number",required:!0,min:0,step:.01},{name:"expense_date",label:"Expense Date",type:"date",required:!0},{name:"merchant",label:"Merchant",type:"text",required:!1},{name:"status",label:"Status",type:"select",required:!0,options:k},{name:"payment_method",label:"Payment Method",type:"select",required:!0,options:[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"online",label:"Online"},{value:"bank_transfer",label:"Bank Transfer"}]},{name:"receipt_number",label:"Receipt Number",type:"text",required:!1},{name:"tax_amount",label:"Tax Amount",type:"number",required:!1,min:0,step:.01},{name:"notes",label:"Notes",type:"textarea",required:!1}],D=[{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}],F=()=>{m.visit("/expenses/create")},q=e=>{m.visit(`/expenses/${e.id}/edit`)},M=e=>{m.visit(`/expenses/${e.id}`)},V=e=>{confirm("Are you sure you want to delete this expense?")&&m.delete(`/expenses/${e.id}`,{preserveScroll:!0,onSuccess:()=>{}})},N=e=>{w.value?d.put(`/expenses/${d.id}`,{preserveScroll:!0,onSuccess:()=>{y()},onError:t=>{n.value&&n.value.setErrors(t)}}):d.post("/expenses",{preserveScroll:!0,onSuccess:()=>{y()},onError:t=>{n.value&&n.value.setErrors(t)}})},y=()=>{h.value=!1,d.reset(),n.value&&n.value.resetForm()},_=()=>{v.value=!0;const e={};Object.keys(o.value).forEach(t=>{o.value[t]&&(e[t]=o.value[t])}),m.get("/expenses",e,{preserveState:!0,preserveScroll:!0,only:["expenses","filters"],onError:t=>{console.error("Error applying filters:",t),t.message?.includes("403")&&alert("You don't have permission to view expenses.")},onFinish:()=>{v.value=!1}})},$=()=>{o.value={search:"",status:"",category:"",date_from:"",date_to:"",min_amount:"",max_amount:""},_()},A=e=>{m.visit(e,{preserveState:!0,preserveScroll:!0,only:["expenses","filters"]})};U(o,()=>{clearTimeout(window.filterTimeout),window.filterTimeout=setTimeout(()=>{_()},300)},{deep:!0});const O=e=>parseFloat(e).toFixed(2),B=e=>new Date(e).toLocaleDateString(),P=e=>e.charAt(0).toUpperCase()+e.slice(1).replace("_"," "),I=e=>({pending:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800";return(e,t)=>(i(),z(G,null,{header:u(()=>t[1]||(t[1]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Expense Management ",-1)])),default:u(()=>[s("div",null,[s("div",Z,[g(X,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),filters:["search","status","category","date","amount"],"status-options":k,"category-options":S,onApply:_,onClear:$},null,8,["modelValue"]),g(J,{data:l(c).data,columns:C,filters:D,pagination:l(c),loading:v.value,onCreate:F,onView:M,onEdit:q,onDelete:V},{amount:u(({item:a})=>[s("span",ee," $"+b(O(a.amount)),1)]),status:u(({item:a})=>[s("span",{class:Y([I(a.status),"px-2 py-1 text-xs font-medium rounded-full"])},b(P(a.status)),3)]),expense_date:u(({item:a})=>[E(b(B(a.expense_date)),1)]),category:u(({item:a})=>[E(b(a.category),1)]),receipts:u(({item:a})=>[s("div",te,[(i(!0),p(H,null,W(a.media.slice(0,3),x=>(i(),p("div",{key:x.id,class:"relative"},[x.mime_type.startsWith("image/")?(i(),p("img",{key:0,src:x.url,alt:x.original_name,class:"h-8 w-8 object-cover rounded border"},null,8,ae)):(i(),p("div",se,t[2]||(t[2]=[s("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])))]))),128)),a.media.length>3?(i(),p("span",le," +"+b(a.media.length-3),1)):a.media.length===0?(i(),p("span",re," None ")):R("",!0)])]),_:1},8,["data","pagination","loading"]),g(K,{links:l(c).links,from:l(c).from,to:l(c).to,total:l(c).total,onNavigate:A},null,8,["links","from","to","total"])])]),g(Q,{show:h.value,title:w.value?"Edit Expense":"Create New Expense",fields:T,"initial-data":l(d),loading:l(d).processing,onClose:y,onSubmit:N,ref_key:"formModal",ref:n},null,8,["show","title","initial-data","loading"])]),_:1}))}};export{fe as default};
